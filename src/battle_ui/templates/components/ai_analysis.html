<!-- AIåˆ†æãƒ‘ãƒãƒ« -->
{% if state.ai_analysis and state.ai_analysis.available %}
<div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-lg shadow p-4 border border-purple-200">
    <div class="flex items-center justify-between mb-3">
        <h3 class="text-sm font-bold text-purple-800 flex items-center gap-2">
            <span class="text-lg">ğŸ¤–</span>
            ReBeL AI åˆ†æ
        </h3>
        <span class="text-xs text-purple-600">CFR-based</span>
    </div>

    <!-- æ¨å®šå‹ç‡ -->
    <div class="mb-4">
        <div class="flex items-center justify-between mb-1">
            <span class="text-xs text-gray-600">AIæ¨å®šå‹ç‡</span>
            <span class="text-sm font-bold text-purple-700">
                {{ (state.ai_analysis.value * 100)|round(1) }}%
            </span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div class="h-2.5 rounded-full transition-all duration-500
                        {% if state.ai_analysis.value > 0.6 %}
                        bg-green-500
                        {% elif state.ai_analysis.value > 0.4 %}
                        bg-yellow-500
                        {% else %}
                        bg-red-500
                        {% endif %}"
                 style="width: {{ (state.ai_analysis.value * 100)|round(1) }}%">
            </div>
        </div>
        <div class="flex justify-between text-xs text-gray-400 mt-1">
            <span>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æœ‰åˆ©</span>
            <span>AIæœ‰åˆ©</span>
        </div>
    </div>

    <!-- è¡Œå‹•é¸æŠç¢ºç‡åˆ†å¸ƒ -->
    <div>
        <h4 class="text-xs font-bold text-gray-600 mb-2">AIã®è¡Œå‹•é¸æŠç¢ºç‡</h4>
        <div class="space-y-2">
            {% for action_id, prob in state.ai_analysis.policy.items()|sort(attribute='1', reverse=true) %}
            {% set action_name = state.ai_analysis.action_names.get(action_id, "è¡Œå‹•" ~ action_id) %}
            <div class="flex items-center gap-2">
                <div class="w-24 text-xs text-gray-700 truncate" title="{{ action_name }}">
                    {{ action_name }}
                </div>
                <div class="flex-1 bg-gray-200 rounded-full h-3 relative">
                    <div class="h-3 rounded-full transition-all duration-300
                                {% if prob > 0.5 %}
                                bg-purple-600
                                {% elif prob > 0.2 %}
                                bg-purple-400
                                {% else %}
                                bg-purple-300
                                {% endif %}"
                         style="width: {{ (prob * 100)|round(1) }}%">
                    </div>
                </div>
                <div class="w-12 text-xs text-right text-gray-600">
                    {{ (prob * 100)|round(1) }}%
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="mt-3 pt-2 border-t border-purple-200">
        <p class="text-xs text-purple-600 italic">
            â€» ã“ã®åˆ†æã¯AIã®æ€è€ƒéç¨‹ã‚’å¯è¦–åŒ–ã—ãŸã‚‚ã®ã§ã™
        </p>
    </div>
</div>
{% elif state.ai_mode == "rebel" %}
<div class="bg-gray-50 rounded-lg shadow p-4 border border-gray-200">
    <div class="flex items-center gap-2 text-gray-500">
        <span class="text-lg">ğŸ¤–</span>
        <span class="text-sm">AIåˆ†æã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
    </div>
</div>
{% else %}
<div class="bg-gray-50 rounded-lg shadow p-4 border border-gray-200">
    <div class="flex items-center gap-2 text-gray-400">
        <span class="text-lg">ğŸ²</span>
        <span class="text-sm">ãƒ©ãƒ³ãƒ€ãƒ AIãƒ¢ãƒ¼ãƒ‰ï¼ˆåˆ†æãªã—ï¼‰</span>
    </div>
</div>
{% endif %}
